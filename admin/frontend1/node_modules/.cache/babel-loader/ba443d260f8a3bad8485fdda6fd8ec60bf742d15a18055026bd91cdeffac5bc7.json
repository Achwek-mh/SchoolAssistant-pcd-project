{"ast":null,"code":"\"use strict\";\n\n/*\n * Copyright 2019 gRPC authors.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.deadlineToString = exports.getRelativeTimeout = exports.getDeadlineTimeoutString = exports.minDeadline = void 0;\nfunction minDeadline() {\n  let minValue = Infinity;\n  for (var _len = arguments.length, deadlineList = new Array(_len), _key = 0; _key < _len; _key++) {\n    deadlineList[_key] = arguments[_key];\n  }\n  for (const deadline of deadlineList) {\n    const deadlineMsecs = deadline instanceof Date ? deadline.getTime() : deadline;\n    if (deadlineMsecs < minValue) {\n      minValue = deadlineMsecs;\n    }\n  }\n  return minValue;\n}\nexports.minDeadline = minDeadline;\nconst units = [['m', 1], ['S', 1000], ['M', 60 * 1000], ['H', 60 * 60 * 1000]];\nfunction getDeadlineTimeoutString(deadline) {\n  const now = new Date().getTime();\n  if (deadline instanceof Date) {\n    deadline = deadline.getTime();\n  }\n  const timeoutMs = Math.max(deadline - now, 0);\n  for (const [unit, factor] of units) {\n    const amount = timeoutMs / factor;\n    if (amount < 1e8) {\n      return String(Math.ceil(amount)) + unit;\n    }\n  }\n  throw new Error('Deadline is too far in the future');\n}\nexports.getDeadlineTimeoutString = getDeadlineTimeoutString;\n/**\n * See https://nodejs.org/api/timers.html#settimeoutcallback-delay-args\n * In particular, \"When delay is larger than 2147483647 or less than 1, the\n * delay will be set to 1. Non-integer delays are truncated to an integer.\"\n * This number of milliseconds is almost 25 days.\n */\nconst MAX_TIMEOUT_TIME = 2147483647;\n/**\n * Get the timeout value that should be passed to setTimeout now for the timer\n * to end at the deadline. For any deadline before now, the timer should end\n * immediately, represented by a value of 0. For any deadline more than\n * MAX_TIMEOUT_TIME milliseconds in the future, a timer cannot be set that will\n * end at that time, so it is treated as infinitely far in the future.\n * @param deadline\n * @returns\n */\nfunction getRelativeTimeout(deadline) {\n  const deadlineMs = deadline instanceof Date ? deadline.getTime() : deadline;\n  const now = new Date().getTime();\n  const timeout = deadlineMs - now;\n  if (timeout < 0) {\n    return 0;\n  } else if (timeout > MAX_TIMEOUT_TIME) {\n    return Infinity;\n  } else {\n    return timeout;\n  }\n}\nexports.getRelativeTimeout = getRelativeTimeout;\nfunction deadlineToString(deadline) {\n  if (deadline instanceof Date) {\n    return deadline.toISOString();\n  } else {\n    const dateDeadline = new Date(deadline);\n    if (Number.isNaN(dateDeadline.getTime())) {\n      return '' + deadline;\n    } else {\n      return dateDeadline.toISOString();\n    }\n  }\n}\nexports.deadlineToString = deadlineToString;","map":{"version":3,"mappings":";;AAAA;;;;;;;;;;;;;;;;;;;;AAmBA,SAAgBA,WAAW,GAA4B;EACrD,IAAIC,QAAQ,GAAGC,QAAQ;EAAC,kCADKC,YAAwB;IAAxBA,YAAwB;EAAA;EAErD,KAAK,MAAMC,QAAQ,IAAID,YAAY,EAAE;IACnC,MAAME,aAAa,GACjBD,QAAQ,YAAYE,IAAI,GAAGF,QAAQ,CAACG,OAAO,EAAE,GAAGH,QAAQ;IAC1D,IAAIC,aAAa,GAAGJ,QAAQ,EAAE;MAC5BA,QAAQ,GAAGI,aAAa;;;EAG5B,OAAOJ,QAAQ;AACjB;AAVAO;AAYA,MAAMC,KAAK,GAA4B,CACrC,CAAC,GAAG,EAAE,CAAC,CAAC,EACR,CAAC,GAAG,EAAE,IAAI,CAAC,EACX,CAAC,GAAG,EAAE,EAAE,GAAG,IAAI,CAAC,EAChB,CAAC,GAAG,EAAE,EAAE,GAAG,EAAE,GAAG,IAAI,CAAC,CACtB;AAED,SAAgBC,wBAAwB,CAACN,QAAkB;EACzD,MAAMO,GAAG,GAAG,IAAIL,IAAI,EAAE,CAACC,OAAO,EAAE;EAChC,IAAIH,QAAQ,YAAYE,IAAI,EAAE;IAC5BF,QAAQ,GAAGA,QAAQ,CAACG,OAAO,EAAE;;EAE/B,MAAMK,SAAS,GAAGC,IAAI,CAACC,GAAG,CAACV,QAAQ,GAAGO,GAAG,EAAE,CAAC,CAAC;EAC7C,KAAK,MAAM,CAACI,IAAI,EAAEC,MAAM,CAAC,IAAIP,KAAK,EAAE;IAClC,MAAMQ,MAAM,GAAGL,SAAS,GAAGI,MAAM;IACjC,IAAIC,MAAM,GAAG,GAAG,EAAE;MAChB,OAAOC,MAAM,CAACL,IAAI,CAACM,IAAI,CAACF,MAAM,CAAC,CAAC,GAAGF,IAAI;;;EAG3C,MAAM,IAAIK,KAAK,CAAC,mCAAmC,CAAC;AACtD;AAbAZ;AAeA;;;;;;AAMA,MAAMa,gBAAgB,GAAG,UAAU;AAEnC;;;;;;;;;AASA,SAAgBC,kBAAkB,CAAClB,QAAkB;EACnD,MAAMmB,UAAU,GAAGnB,QAAQ,YAAYE,IAAI,GAAGF,QAAQ,CAACG,OAAO,EAAE,GAAGH,QAAQ;EAC3E,MAAMO,GAAG,GAAG,IAAIL,IAAI,EAAE,CAACC,OAAO,EAAE;EAChC,MAAMiB,OAAO,GAAGD,UAAU,GAAGZ,GAAG;EAChC,IAAIa,OAAO,GAAG,CAAC,EAAE;IACf,OAAO,CAAC;GACT,MAAM,IAAIA,OAAO,GAAGH,gBAAgB,EAAE;IACrC,OAAOnB,QAAQ;GAChB,MAAM;IACL,OAAOsB,OAAO;;AAElB;AAXAhB;AAaA,SAAgBiB,gBAAgB,CAACrB,QAAkB;EACjD,IAAIA,QAAQ,YAAYE,IAAI,EAAE;IAC5B,OAAOF,QAAQ,CAACsB,WAAW,EAAE;GAC9B,MAAM;IACL,MAAMC,YAAY,GAAG,IAAIrB,IAAI,CAACF,QAAQ,CAAC;IACvC,IAAIwB,MAAM,CAACC,KAAK,CAACF,YAAY,CAACpB,OAAO,EAAE,CAAC,EAAE;MACxC,OAAO,EAAE,GAAGH,QAAQ;KACrB,MAAM;MACL,OAAOuB,YAAY,CAACD,WAAW,EAAE;;;AAGvC;AAXAlB","names":["minDeadline","minValue","Infinity","deadlineList","deadline","deadlineMsecs","Date","getTime","exports","units","getDeadlineTimeoutString","now","timeoutMs","Math","max","unit","factor","amount","String","ceil","Error","MAX_TIMEOUT_TIME","getRelativeTimeout","deadlineMs","timeout","deadlineToString","toISOString","dateDeadline","Number","isNaN"],"sources":["/home/achwak/node_modules/@grpc/grpc-js/src/deadline.ts"],"sourcesContent":["/*\n * Copyright 2019 gRPC authors.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\n\nexport type Deadline = Date | number;\n\nexport function minDeadline(...deadlineList: Deadline[]): Deadline {\n  let minValue = Infinity;\n  for (const deadline of deadlineList) {\n    const deadlineMsecs =\n      deadline instanceof Date ? deadline.getTime() : deadline;\n    if (deadlineMsecs < minValue) {\n      minValue = deadlineMsecs;\n    }\n  }\n  return minValue;\n}\n\nconst units: Array<[string, number]> = [\n  ['m', 1],\n  ['S', 1000],\n  ['M', 60 * 1000],\n  ['H', 60 * 60 * 1000],\n];\n\nexport function getDeadlineTimeoutString(deadline: Deadline) {\n  const now = new Date().getTime();\n  if (deadline instanceof Date) {\n    deadline = deadline.getTime();\n  }\n  const timeoutMs = Math.max(deadline - now, 0);\n  for (const [unit, factor] of units) {\n    const amount = timeoutMs / factor;\n    if (amount < 1e8) {\n      return String(Math.ceil(amount)) + unit;\n    }\n  }\n  throw new Error('Deadline is too far in the future')\n}\n\n/**\n * See https://nodejs.org/api/timers.html#settimeoutcallback-delay-args\n * In particular, \"When delay is larger than 2147483647 or less than 1, the\n * delay will be set to 1. Non-integer delays are truncated to an integer.\"\n * This number of milliseconds is almost 25 days.\n */\nconst MAX_TIMEOUT_TIME = 2147483647;\n\n/**\n * Get the timeout value that should be passed to setTimeout now for the timer\n * to end at the deadline. For any deadline before now, the timer should end\n * immediately, represented by a value of 0. For any deadline more than\n * MAX_TIMEOUT_TIME milliseconds in the future, a timer cannot be set that will\n * end at that time, so it is treated as infinitely far in the future.\n * @param deadline \n * @returns\n */\nexport function getRelativeTimeout(deadline: Deadline) {\n  const deadlineMs = deadline instanceof Date ? deadline.getTime() : deadline;\n  const now = new Date().getTime();\n  const timeout = deadlineMs - now;\n  if (timeout < 0) {\n    return 0;\n  } else if (timeout > MAX_TIMEOUT_TIME) {\n    return Infinity\n  } else {\n    return timeout;\n  }\n}\n\nexport function deadlineToString(deadline: Deadline): string {\n  if (deadline instanceof Date) {\n    return deadline.toISOString();\n  } else {\n    const dateDeadline = new Date(deadline);\n    if (Number.isNaN(dateDeadline.getTime())) {\n      return '' + deadline;\n    } else {\n      return dateDeadline.toISOString();\n    }\n  }\n}"]},"metadata":{},"sourceType":"script","externalDependencies":[]}